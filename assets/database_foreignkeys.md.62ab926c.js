import{_ as s,c as n,o as a,a as e}from"./app.5353d95f.js";const A=JSON.parse('{"title":"Foreign Keys in Laravel","description":"","frontmatter":{},"headers":[{"level":2,"title":"Modern Syntax","slug":"modern-syntax","link":"#modern-syntax","children":[]},{"level":2,"title":"Legacy Setup (for integer IDs)","slug":"legacy-setup-for-integer-ids","link":"#legacy-setup-for-integer-ids","children":[]},{"level":2,"title":"What ->constrained() Does","slug":"what-constrained-does","link":"#what-constrained-does","children":[]}],"relativePath":"database/foreignkeys.md"}'),l={name:"database/foreignkeys.md"},o=e(`<h1 id="foreign-keys-in-laravel" tabindex="-1">Foreign Keys in Laravel <a class="header-anchor" href="#foreign-keys-in-laravel" aria-hidden="true">#</a></h1><h2 id="modern-syntax" tabindex="-1">Modern Syntax <a class="header-anchor" href="#modern-syntax" aria-hidden="true">#</a></h2><div class="language-php"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">table</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">foreignId</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">user_id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)-&gt;</span><span style="color:#82AAFF;">constrained</span><span style="color:#89DDFF;">();</span></span>
<span class="line"></span></code></pre></div><ul><li>Creates <code>unsignedBigInteger(&#39;user_id&#39;)</code></li><li>Adds foreign key to table <code>users</code> on column <code>id</code> (name conventions).</li></ul><p>With cascade:</p><div class="language-php"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">table</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">foreignId</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">user_id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">constrained</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">onUpdate</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cascade</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">onDelete</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cascade</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">);</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// or use &#39;set null&#39;</span></span>
<span class="line"></span></code></pre></div><p>Custom table/index:</p><div class="language-php"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">table</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">foreignId</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">user_id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">references</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">posts_user_id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)-&gt;</span><span style="color:#82AAFF;">on</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">users</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre></div><h2 id="legacy-setup-for-integer-ids" tabindex="-1">Legacy Setup (for <code>integer</code> IDs) <a class="header-anchor" href="#legacy-setup-for-integer-ids" aria-hidden="true">#</a></h2><p>In older Laravel apps, <code>$table-&gt;id()</code> created an unsigned <code>integer</code> column instead of an unsigned <code>bigInteger</code>.<br> Therefore, <code>foreignId</code> (which uses <code>unsignedBigInteger</code>) won\u2019t match and will fail.<br> You must either:</p><ol><li>Update the referenced <code>id</code> to <code>bigIncrements</code>, or</li><li>Define the foreign key manually as shown below:</li></ol><div class="language-php"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">table</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">integer</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">user_id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)-&gt;</span><span style="color:#82AAFF;">unsigned</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">table</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">foreign</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">user_id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">constrained</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">onDelete</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cascade</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre></div><h2 id="what-constrained-does" tabindex="-1">What <code>-&gt;constrained()</code> Does <a class="header-anchor" href="#what-constrained-does" aria-hidden="true">#</a></h2><p>Calling <code>-&gt;constrained()</code> is a shortcut for:</p><div class="language-php"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">table</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">foreignId</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">user_id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">references</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">on</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">users</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre></div><ul><li>It creates a foreign key using Laravel&#39;s naming conventions.</li><li>Without <code>-&gt;constrained()</code>, only the column is created \u2013 no foreign key constraint is added.</li></ul><p>It uses Laravel conventions to:</p><ul><li>Reference the <code>id</code> column by default</li><li>Infer the table name from the column name (<code>user_id</code> \u2192 <code>users</code>)</li><li>Use pluralization rules (<code>Str::of(&#39;user_id&#39;)-&gt;beforeLast(&#39;_id&#39;)-&gt;plural()</code>)</li></ul><p>This is equivalent to:</p><div class="language-php"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">constrained</span><span style="color:#89DDFF;">($</span><span style="color:#A6ACCD;">table </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">column </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$this-&gt;</span><span style="color:#82AAFF;">references</span><span style="color:#89DDFF;">($</span><span style="color:#A6ACCD;">column</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">on</span><span style="color:#89DDFF;">($</span><span style="color:#A6ACCD;">table </span><span style="color:#89DDFF;">??</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Str</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">of</span><span style="color:#89DDFF;">($this-&gt;</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">)-&gt;</span><span style="color:#82AAFF;">beforeLast</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">_</span><span style="color:#89DDFF;">&#39;.</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">column</span><span style="color:#89DDFF;">)-&gt;</span><span style="color:#82AAFF;">plural</span><span style="color:#89DDFF;">());</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u{1F449} <a href="https://laravel.com/docs/12.x/migrations#foreign-key-constraints" target="_blank" rel="noreferrer">Laravel Docs</a></p>`,21),p=[o];function t(c,r,D,F,i,y){return a(),n("div",null,p)}const g=s(l,[["render",t]]);export{A as __pageData,g as default};
